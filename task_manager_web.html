<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Task Manager</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f8faf9;
            color: #2d3748;
            line-height: 1.6;
        }

        /* –ë–æ–∫–æ–≤–æ–µ –º–µ–Ω—é */
        .sidebar {
            position: fixed;
            left: 0;
            top: 0;
            width: 260px;
            height: 100vh;
            background: white;
            border-right: 1px solid #e2e8f0;
            z-index: 1000;
            transition: transform 0.3s ease;
        }

        .sidebar-header {
            padding: 30px 25px;
            border-bottom: 1px solid #e2e8f0;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: 700;
            color: #00796b;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .nav-menu {
            padding: 20px 0;
        }

        .nav-item {
            display: flex;
            align-items: center;
            padding: 12px 25px;
            color: #64748b;
            text-decoration: none;
            transition: all 0.2s ease;
            cursor: pointer;
            border: none;
            background: none;
            width: 100%;
            text-align: left;
            font-size: 14px;
        }

        .nav-item:hover {
            background: #f1f5f9;
            color: #00796b;
        }

        .nav-item.active {
            background: #e0f2f1;
            color: #00796b;
            border-right: 3px solid #00796b;
        }

        .nav-item svg {
            width: 20px;
            height: 20px;
            margin-right: 12px;
        }

        /* –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç */
        .main-content {
            margin-left: 260px;
            min-height: 100vh;
            background: #f8faf9;
        }

        .header {
            background: white;
            padding: 20px 30px;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .page-title {
            font-size: 1.75rem;
            font-weight: 600;
            color: #1a202c;
        }

        .header-actions {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 16px;
            border-radius: 20px;
            background: #f1f5f9;
            border: 1px solid #e2e8f0;
        }

        .user-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            object-fit: cover;
        }

        .user-details {
            display: flex;
            flex-direction: column;
        }

        .user-name {
            font-size: 14px;
            font-weight: 500;
            color: #1a202c;
            line-height: 1.2;
        }

        .user-role {
            font-size: 12px;
            color: #64748b;
            line-height: 1.2;
        }

        .logout-btn {
            background: none;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            padding: 6px 12px;
            color: #64748b;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.2s ease;
        }

        .logout-btn:hover {
            background: #f1f5f9;
            color: #1a202c;
        }

        .content {
            padding: 30px;
        }

        /* –ö–Ω–æ–ø–∫–∏ */
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: #00796b;
            color: white;
        }

        .btn-primary:hover {
            background: #00695c;
        }

        .btn-secondary {
            background: #f1f5f9;
            color: #64748b;
            border: 1px solid #e2e8f0;
        }

        .btn-secondary:hover {
            background: #e2e8f0;
        }

        .btn-success {
            background: #4caf50;
            color: white;
        }

        .btn-success:hover {
            background: #43a047;
        }

        .btn-danger {
            background: #f44336;
            color: white;
        }

        .btn-danger:hover {
            background: #e53935;
        }

        /* –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            border: 1px solid #e2e8f0;
            transition: transform 0.2s ease;
        }

        .stat-card:hover {
            transform: translateY(-2px);
        }

        .stat-number {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .stat-number.total { color: #00796b; }
        .stat-number.completed { color: #4caf50; }
        .stat-number.pending { color: #ff9800; }
        .stat-number.overdue { color: #f44336; }

        .stat-label {
            color: #64748b;
            font-size: 14px;
            font-weight: 500;
        }

        /* –ö–∞—Ä—Ç–æ—á–∫–∏ –∑–∞–¥–∞—á */
        .tasks-container {
            background: white;
            border-radius: 12px;
            border: 1px solid #e2e8f0;
            overflow: hidden;
        }

        .tasks-header {
            padding: 20px 25px;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .filter-tabs {
            display: flex;
            gap: 5px;
        }

        .tab {
            padding: 8px 16px;
            border: none;
            background: none;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 14px;
            font-weight: 500;
            color: #64748b;
        }

        .tab.active {
            background: #e0f2f1;
            color: #00796b;
        }

        .task-list {
            max-height: 600px;
            overflow-y: auto;
        }

        .task-item {
            padding: 20px 25px;
            border-bottom: 1px solid #f1f5f9;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background 0.2s ease;
        }

        .task-item:hover {
            background: #f8faf9;
        }

        .task-info {
            flex: 1;
        }

        .task-title {
            font-weight: 600;
            margin-bottom: 5px;
            color: #1a202c;
        }

        .task-meta {
            display: flex;
            gap: 20px;
            font-size: 13px;
            color: #64748b;
        }

        .task-status {
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
        }

        .status-pending {
            background: #fff3cd;
            color: #856404;
        }

        .status-completed {
            background: #d4edda;
            color: #155724;
        }

        .status-overdue {
            background: #f8d7da;
            color: #721c24;
        }

        .status-review {
            background: #e3f2fd;
            color: #1565c0;
        }

        .status-revision {
            background: #fbe9e7;
            color: #d84315;
        }

        .task-actions {
            display: flex;
            gap: 10px;
        }

        /* –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 16px;
            padding: 30px;
            width: 90%;
            max-width: 500px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }

        .modal-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: #1a202c;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #64748b;
        }

        /* –§–æ—Ä–º—ã */
        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            font-weight: 500;
            margin-bottom: 8px;
            color: #374151;
        }

        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.2s ease;
        }

        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: #00796b;
        }

        .form-textarea {
            resize: vertical;
            min-height: 80px;
        }

        /* –°–ø–∏—Å–æ–∫ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ */
        .employee-list {
            display: grid;
            gap: 15px;
        }

        .employee-card {
            background: #f8faf9;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .employee-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .employee-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #00796b;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
        }

        .employee-details h4 {
            font-weight: 600;
            margin-bottom: 2px;
        }

        .employee-details p {
            font-size: 13px;
            color: #64748b;
        }

        /* –†–µ–π—Ç–∏–Ω–≥ */
        .rating-item {
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: transform 0.2s ease;
        }

        .rating-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .rating-item.top-1 {
            background: linear-gradient(135deg, #ffd700, #ffed4e);
            border-color: #ffd700;
        }

        .rating-item.top-2 {
            background: linear-gradient(135deg, #c0c0c0, #e5e5e5);
            border-color: #c0c0c0;
        }

        .rating-item.top-3 {
            background: linear-gradient(135deg, #cd7f32, #daa55a);
            border-color: #cd7f32;
        }

        .rating-position {
            font-size: 2rem;
            font-weight: 700;
            min-width: 60px;
            text-align: center;
        }

        .rating-info {
            flex: 1;
            margin-left: 20px;
        }

        .rating-name {
            font-weight: 600;
            font-size: 1.1rem;
            margin-bottom: 5px;
        }

        .rating-username {
            color: #64748b;
            font-size: 14px;
        }

        .rating-stats {
            display: flex;
            gap: 20px;
            align-items: center;
        }

        .rating-points {
            font-size: 1.5rem;
            font-weight: 700;
            color: #00796b;
        }

        .rating-balance {
            font-size: 1.2rem;
            color: #2196f3;
        }

        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
            }

            .sidebar.mobile-open {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
            }

            .content {
                padding: 20px;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #64748b;
        }

        .empty-state svg {
            width: 64px;
            height: 64px;
            margin-bottom: 16px;
            opacity: 0.5;
        }
    </style>
</head>
<body>
    <!-- –ë–æ–∫–æ–≤–æ–µ –º–µ–Ω—é -->
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <div class="logo">
                <svg viewBox="0 0 24 24" fill="currentColor" width="24" height="24">
                    <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
                </svg>
                Task Manager
            </div>
        </div>
        <nav class="nav-menu">
            <button class="nav-item active" onclick="showPage('dashboard')">
                <svg viewBox="0 0 24 24" fill="currentColor">
                    <path d="M3 13h8V3H3v10zm0 8h8v-6H3v6zm10 0h8V11h-8v10zm0-18v6h8V3h-8z"/>
                </svg>
                –î–∞—à–±–æ—Ä–¥
            </button>
            <button class="nav-item" onclick="showPage('employees')">
                <svg viewBox="0 0 24 24" fill="currentColor">
                    <path d="M16 7c0-2.21-1.79-4-4-4S8 4.79 8 7s1.79 4 4 4 4-1.79 4-4zm-4 6c-2.67 0-8 1.34-8 4v3h16v-3c0-2.66-5.33-4-8-4z"/>
                </svg>
                –°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏
            </button>
            <button class="nav-item" onclick="showPage('rating')">
                <svg viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                </svg>
                –†–µ–π—Ç–∏–Ω–≥
            </button>
            <button class="nav-item" onclick="showPage('analytics')">
                <svg viewBox="0 0 24 24" fill="currentColor">
                    <path d="M16,11V3H8v6H2v12h20V11H16z M10,5h4v14h-4V5z M4,11h4v8H4V11z M20,19h-4v-6h4V19z"/>
                </svg>
                –ê–Ω–∞–ª–∏—Ç–∏–∫–∞
            </button>
            <button class="nav-item" onclick="showPage('users')">
                <svg viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12 2c2.21 0 4 1.79 4 4 0 2.21-1.59 3.92-3.75 4l.75.75 2.25 2.25c.39.39.39 1.02 0 1.41s-1.02.39-1.41 0L11.59 12.16c-.59.13-1.2.34-1.8.34C7.58 12.5 6 10.92 6 9s1.58-3.5 3.79-3.5zM10 7c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1z"/>
                    <path d="M16 13c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zM18 17v-1.5c0-1.38-1.12-2.5-2.5-2.5h-3c-1.38 0-2.5 1.12-2.5 2.5V17h8z"/>
                </svg>
                –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
            </button>
            <button class="nav-item" onclick="showPage('settings')">
                <svg viewBox="0 0 24 24" fill="currentColor">
                    <path d="M19.14,12.94c0.04-0.3,0.06-0.61,0.06-0.94c0-0.32-0.02-0.64-0.07-0.94l2.03-1.58c0.18-0.14,0.23-0.41,0.12-0.61 l-1.92-3.32c-0.12-0.22-0.37-0.29-0.59-0.22l-2.39,0.96c-0.5-0.38-1.03-0.7-1.62-0.94L14.4,2.81c-0.04-0.24-0.24-0.41-0.48-0.41 h-3.84c-0.24,0-0.43,0.17-0.47,0.41L9.25,5.35C8.66,5.59,8.12,5.92,7.63,6.29L5.24,5.33c-0.22-0.08-0.47,0-0.59,0.22L2.74,8.87 C2.62,9.08,2.66,9.34,2.86,9.48l2.03,1.58C4.84,11.36,4.8,11.69,4.8,12s0.02,0.64,0.07,0.94l-2.03,1.58 c-0.18,0.14-0.23,0.41-0.12,0.61l1.92,3.32c0.12,0.22,0.37,0.29,0.59,0.22l2.39-0.96c0.5,0.38,1.03,0.7,1.62,0.94l0.36,2.54 c0.05,0.24,0.24,0.41,0.48,0.41h3.84c0.24,0,0.44-0.17,0.47-0.41l0.36-2.54c0.59-0.24,1.13-0.56,1.62-0.94l2.39,0.96 c0.22,0.08,0.47,0,0.59-0.22l1.92-3.32c0.12-0.22,0.07-0.47-0.12-0.61L19.14,12.94z M12,15.6c-1.98,0-3.6-1.62-3.6-3.6 s1.62-3.6,3.6-3.6s3.6,1.62,3.6,3.6S13.98,15.6,12,15.6z"/>
                </svg>
                –ù–∞—Å—Ç—Ä–æ–π–∫–∏
            </button>
        </nav>
    </div>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
    <div class="main-content">
        <!-- –î–∞—à–±–æ—Ä–¥ -->
        <div id="dashboard-page" class="page">
            <div class="header">
                <h1 class="page-title">–î–∞—à–±–æ—Ä–¥</h1>
                <div class="header-actions">
                    <div class="user-info" id="userInfo">
                        <img src="" alt="Avatar" class="user-avatar" id="userAvatar">
                        <div class="user-details">
                            <div class="user-name" id="userName">Loading...</div>
                            <div class="user-role" id="userRole">...</div>
                        </div>
                    </div>
                    <button class="logout-btn" onclick="logout()">–í—ã–π—Ç–∏</button>
                    <button class="btn btn-primary" onclick="openTaskModal()">
                        <svg viewBox="0 0 24 24" fill="currentColor" width="16" height="16">
                            <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
                        </svg>
                        –ù–æ–≤–∞—è –∑–∞–¥–∞—á–∞
                    </button>
                </div>
            </div>
            <div class="content">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number total" id="totalTasks">8</div>
                        <div class="stat-label">–í—Å–µ–≥–æ –∑–∞–¥–∞—á</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number completed" id="completedTasks">5</div>
                        <div class="stat-label">–í—ã–ø–æ–ª–Ω–µ–Ω–æ</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number pending" id="pendingTasks">2</div>
                        <div class="stat-label">–í —Ä–∞–±–æ—Ç–µ</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number overdue" id="overdueTasks">1</div>
                        <div class="stat-label">–ü—Ä–æ—Å—Ä–æ—á–µ–Ω–æ</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" style="color: #2196f3;" id="reviewTasks">0</div>
                        <div class="stat-label">–ù–∞ –ø—Ä–æ–≤–µ—Ä–∫–µ</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" style="color: #ff5722;" id="revisionTasks">0</div>
                        <div class="stat-label">–ù–∞ –¥–æ—Ä–∞–±–æ—Ç–∫–µ</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" style="color: #9c27b0;" id="avgCompletionTime">0</div>
                        <div class="stat-label">–°—Ä. –≤—Ä–µ–º—è (–º–∏–Ω)</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" style="color: #607d8b;" id="avgEfficiency">0%</div>
                        <div class="stat-label">–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" style="color: #795548;" id="totalRevisions">0</div>
                        <div class="stat-label">–í—Å–µ–≥–æ –¥–æ—Ä–∞–±–æ—Ç–æ–∫</div>
                    </div>
                </div>

                <div class="tasks-container">
                    <div class="tasks-header">
                        <h3>–ó–∞–¥–∞—á–∏</h3>
                        <div class="filter-tabs">
                            <button class="tab active" onclick="filterTasks('all')">–í—Å–µ</button>
                            <button class="tab" onclick="filterTasks('pending')">–í —Ä–∞–±–æ—Ç–µ</button>
                            <button class="tab" onclick="filterTasks('review')">–ù–∞ –ø—Ä–æ–≤–µ—Ä–∫–µ</button>
                            <button class="tab" onclick="filterTasks('revision')">–ù–∞ –¥–æ—Ä–∞–±–æ—Ç–∫–µ</button>
                            <button class="tab" onclick="filterTasks('completed')">–í—ã–ø–æ–ª–Ω–µ–Ω–æ</button>
                            <button class="tab" onclick="filterTasks('overdue')">–ü—Ä–æ—Å—Ä–æ—á–µ–Ω–æ</button>
                        </div>
                    </div>
                    <div class="task-list" id="taskList">
                        <!-- –ó–∞–¥–∞—á–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                    </div>
                </div>
            </div>
        </div>

        <!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ -->
        <div id="employees-page" class="page" style="display: none;">
            <div class="header">
                <h1 class="page-title">–°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏</h1>
                <div class="header-actions">
                    <button class="btn btn-primary" onclick="openEmployeeModal()">
                        <svg viewBox="0 0 24 24" fill="currentColor" width="16" height="16">
                            <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
                        </svg>
                        –î–æ–±–∞–≤–∏—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞
                    </button>
                </div>
            </div>
            <div class="content">
                <div class="tasks-container">
                    <div class="tasks-header">
                        <h3>–°–ø–∏—Å–æ–∫ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤</h3>
                    </div>
                    <div style="padding: 25px;">
                        <div class="employee-list" id="employeeList">
                            <!-- –°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ —Ä–µ–π—Ç–∏–Ω–≥–∞ -->
        <div id="rating-page" class="page" style="display: none;">
            <div class="header">
                <h1 class="page-title">–†–µ–π—Ç–∏–Ω–≥ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤</h1>
            </div>
            <div class="content">
                <div class="tasks-container">
                    <div class="tasks-header">
                        <h3>–¢–æ–ø –ø–æ –±–∞–ª–ª–∞–º</h3>
                        <button class="btn btn-secondary" onclick="loadRating()">
                            <svg viewBox="0 0 24 24" fill="currentColor" width="16" height="16">
                                <path d="M12 4V1L8 5l4 4V6c3.31 0 6 2.69 6 6 0 1.01-.25 1.97-.7 2.8l1.46 1.46C19.54 15.03 20 13.57 20 12c0-4.42-3.58-8-8-8z"/>
                                <path d="M12 18c-3.31 0-6-2.69-6-6 0-1.01.25-1.97.7-2.8L5.24 7.74C4.46 8.97 4 10.43 4 12c0 4.42 3.58 8 8 8v3l4-4-4-4v3z"/>
                            </svg>
                            –û–±–Ω–æ–≤–∏—Ç—å
                        </button>
                    </div>
                    <div style="padding: 25px;">
                        <div id="ratingList">
                            <!-- –†–µ–π—Ç–∏–Ω–≥ –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ -->
        <div id="analytics-page" class="page" style="display: none;">
            <div class="header">
                <h1 class="page-title">–ê–Ω–∞–ª–∏—Ç–∏–∫–∞</h1>
                <div class="header-actions">
                    <button class="btn btn-secondary" onclick="loadAnalytics()">
                        <svg viewBox="0 0 24 24" fill="currentColor" width="16" height="16">
                            <path d="M12 4V1L8 5l4 4V6c3.31 0 6 2.69 6 6 0 1.01-.25 1.97-.7 2.8l1.46 1.46C19.54 15.03 20 13.57 20 12c0-4.42-3.58-8-8-8z"/>
                            <path d="M12 18c-3.31 0-6-2.69-6-6 0-1.01.25-1.97.7-2.8L5.24 7.74C4.46 8.97 4 10.43 4 12c0 4.42 3.58 8 8 8v3l4-4-4-4v3z"/>
                        </svg>
                        –û–±–Ω–æ–≤–∏—Ç—å
                    </button>
                </div>
            </div>
            <div class="content">
                <div class="tasks-container">
                    <div class="tasks-header">
                        <h3>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è–º</h3>
                    </div>
                    <div style="padding: 25px;">
                        <div id="detailedStatsContainer">
                            <!-- –î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                        </div>
                    </div>
                </div>
                
                <div class="tasks-container" style="margin-top: 30px;">
                    <div class="tasks-header">
                        <h3>–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 30 –¥–Ω–µ–π</h3>
                    </div>
                    <div style="padding: 25px;">
                        <div id="performanceMetricsContainer">
                            <!-- –ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π -->
        <div id="users-page" class="page" style="display: none;">
            <div class="header">
                <h1 class="page-title">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏</h1>
                <div class="header-actions">
                    <button class="btn btn-secondary" onclick="loadUsers()">
                        <svg viewBox="0 0 24 24" fill="currentColor" width="16" height="16">
                            <path d="M12 4V1L8 5l4 4V6c3.31 0 6 2.69 6 6 0 1.01-.25 1.97-.7 2.8l1.46 1.46C19.54 15.03 20 13.57 20 12c0-4.42-3.58-8-8-8z"/>
                            <path d="M12 18c-3.31 0-6-2.69-6-6 0-1.01.25-1.97.7-2.8L5.24 7.74C4.46 8.97 4 10.43 4 12c0 4.42 3.58 8 8 8v3l4-4-4-4v3z"/>
                        </svg>
                        –û–±–Ω–æ–≤–∏—Ç—å
                    </button>
                </div>
            </div>
            <div class="content">
                <div class="tasks-container">
                    <div class="tasks-header">
                        <h3>–†–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</h3>
                        <div style="font-size: 14px; color: #64748b;">
                            <strong>executor</strong> - –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å, <strong>manager</strong> - –º–µ–Ω–µ–¥–∂–µ—Ä, <strong>admin</strong> - –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä
                        </div>
                    </div>
                    <div style="padding: 25px;">
                        <div id="usersList">
                            <!-- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ -->
        <div id="settings-page" class="page" style="display: none;">
            <div class="header">
                <h1 class="page-title">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h1>
            </div>
            <div class="content">
                <div class="tasks-container">
                    <div class="tasks-header">
                        <h3>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∏—Å—Ç–µ–º—ã</h3>
                    </div>
                    <div style="padding: 25px;">
                        <div class="form-group">
                            <label class="form-label">ü§ñ Telegram Bot</label>
                            <div style="background: #f8faf9; border: 1px solid #e2e8f0; border-radius: 8px; padding: 15px; margin-bottom: 15px;">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                                    <div>
                                        <strong>–°—Ç–∞—Ç—É—Å –±–æ—Ç–∞:</strong>
                                        <span id="botStatus" style="margin-left: 10px;">–ü—Ä–æ–≤–µ—Ä–∫–∞...</span>
                                    </div>
                                    <button id="refreshBotStatus" class="btn btn-secondary" style="padding: 4px 8px; font-size: 12px;">üîÑ</button>
                                </div>
                                
                                <div id="botTokenForm">
                                    <div style="margin-bottom: 10px;">
                                        <label class="form-label" style="margin-bottom: 5px;">–¢–æ–∫–µ–Ω –±–æ—Ç–∞:</label>
                                        <div style="display: flex; gap: 10px;">
                                            <input type="text" id="botTokenInput" class="form-input" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–æ–∫–µ–Ω –æ—Ç @BotFather" style="flex: 1;">
                                            <button id="saveBotToken" class="btn btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                                        </div>
                                    </div>
                                    <div style="display: flex; gap: 10px;">
                                        <button id="stopBot" class="btn btn-danger" style="font-size: 12px;">–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –±–æ—Ç–∞</button>
                                        <button id="testBot" class="btn btn-secondary" style="font-size: 12px;">–¢–µ—Å—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π</button>
                                    </div>
                                </div>
                                
                                <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #e2e8f0;">
                                    <h4 style="margin: 0 0 10px 0; color: #00796b;">–ö–∞–∫ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å:</h4>
                                    <ol style="margin: 0; padding-left: 20px; font-size: 14px; color: #64748b;">
                                        <li>–°–æ–∑–¥–∞–π—Ç–µ –±–æ—Ç–∞ —á–µ—Ä–µ–∑ @BotFather –≤ Telegram</li>
                                        <li>–°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ç–æ–∫–µ–Ω –±–æ—Ç–∞</li>
                                        <li>–í—Å—Ç–∞–≤—å—Ç–µ —Ç–æ–∫–µ–Ω –≤ –ø–æ–ª–µ –≤—ã—à–µ –∏ –Ω–∞–∂–º–∏—Ç–µ "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å"</li>
                                        <li>–î–æ–±–∞–≤—å—Ç–µ –±–æ—Ç–∞ –≤ –≥—Ä—É–ø–ø—É –∏ –¥–∞–π—Ç–µ –ø—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</li>
                                    </ol>
                                    <div style="margin-top: 10px; padding: 8px; background: #e0f2f1; border-radius: 4px;">
                                        <strong>–ö–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞:</strong><br>
                                        <code>/task –∑–∞–¥–∞—á–∞ @–∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å –æ–ø–∏—Å–∞–Ω–∏–µ –¥–µ–¥–ª–∞–π–Ω</code><br>
                                        <code>/tasks</code> - —Å–ø–∏—Å–æ–∫ –∑–∞–¥–∞—á<br>
                                        <code>/help</code> - –ø–æ–º–æ—â—å
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">üè¢ –†–∞–±–æ—á–∏–π —á–∞—Ç</label>
                            <div style="background: #f8faf9; border: 1px solid #e2e8f0; border-radius: 8px; padding: 15px; margin-bottom: 15px;">
                                <div style="margin-bottom: 10px;">
                                    <label class="form-label" style="margin-bottom: 5px;">Chat ID —Ä–∞–±–æ—á–µ–≥–æ —á–∞—Ç–∞:</label>
                                    <div style="display: flex; gap: 10px;">
                                        <input type="text" id="workChatId" class="form-input" placeholder="-1001234567890" style="flex: 1;">
                                        <button id="saveWorkChatId" class="btn btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                                    </div>
                                    <div style="font-size: 12px; color: #64748b; margin-top: 5px;">
                                        –î–æ–±–∞–≤—å—Ç–µ –±–æ—Ç–∞ –≤ –≥—Ä—É–ø–ø—É –∏ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ –∫–æ–º–∞–Ω–¥—É /tasks —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å Chat ID
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏</label>
                            <input type="text" class="form-input" value="–ú–æ—è –∫–æ–º–ø–∞–Ω–∏—è" id="companyName">
                        </div>
                        <div class="form-group">
                            <label class="form-label">–ß–∞—Å–æ–≤–æ–π –ø–æ—è—Å</label>
                            <select class="form-select" id="timezone">
                                <option>UTC+5 (–¢–∞—à–∫–µ–Ω—Ç)</option>
                                <option>UTC+3 (–ú–æ—Å–∫–≤–∞)</option>
                                <option>UTC+0 (UTC)</option>
                            </select>
                        </div>
                        <button class="btn btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∑–∞–¥–∞—á–∏ -->
    <div class="modal" id="taskModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">–ù–æ–≤–∞—è –∑–∞–¥–∞—á–∞</h3>
                <button class="close-btn" onclick="closeModal('taskModal')">&times;</button>
            </div>
            <form id="taskForm">
                <div class="form-group">
                    <label class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏ *</label>
                    <input type="text" class="form-input" id="taskTitle" required>
                </div>
                <div class="form-group">
                    <label class="form-label">–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å *</label>
                    <select class="form-select" id="taskAssignee" required>
                        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">–û–ø–∏—Å–∞–Ω–∏–µ</label>
                    <textarea class="form-textarea" id="taskDescription"></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">–î–µ–¥–ª–∞–π–Ω *</label>
                    <input type="datetime-local" class="form-input" id="taskDeadline" required>
                </div>
                <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 25px;">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('taskModal')">–û—Ç–º–µ–Ω–∞</button>
                    <button type="submit" class="btn btn-primary">–°–æ–∑–¥–∞—Ç—å –∑–∞–¥–∞—á—É</button>
                </div>
            </form>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ -->
    <div class="modal" id="employeeModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">–î–æ–±–∞–≤–∏—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞</h3>
                <button class="close-btn" onclick="closeModal('employeeModal')">&times;</button>
            </div>
            <form id="employeeForm">
                <div class="form-group">
                    <label class="form-label">–ò–º—è *</label>
                    <input type="text" class="form-input" id="employeeName" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Email *</label>
                    <input type="email" class="form-input" id="employeeEmail" required>
                </div>
                <div class="form-group">
                    <label class="form-label">–î–æ–ª–∂–Ω–æ—Å—Ç—å</label>
                    <input type="text" class="form-input" id="employeePosition">
                </div>
                <div class="form-group">
                    <label class="form-label">Username (–¥–ª—è Telegram)</label>
                    <input type="text" class="form-input" id="employeeUsername" placeholder="@username">
                </div>
                <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 25px;">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('employeeModal')">–û—Ç–º–µ–Ω–∞</button>
                    <button type="submit" class="btn btn-primary">–î–æ–±–∞–≤–∏—Ç—å</button>
                </div>
            </form>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–¥–∞—á–∏ -->
    <div class="modal" id="editTaskModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∑–∞–¥–∞—á—É</h3>
                <button class="close-btn" onclick="closeModal('editTaskModal')">&times;</button>
            </div>
            <form id="editTaskForm">
                <input type="hidden" id="editTaskId">
                <div class="form-group">
                    <label class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏ *</label>
                    <input type="text" class="form-input" id="editTaskTitle" required>
                </div>
                <div class="form-group">
                    <label class="form-label">–û–ø–∏—Å–∞–Ω–∏–µ</label>
                    <textarea class="form-textarea" id="editTaskDescription"></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">–î–µ–¥–ª–∞–π–Ω *</label>
                    <input type="datetime-local" class="form-input" id="editTaskDeadline" required>
                </div>
                <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 25px;">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('editTaskModal')">–û—Ç–º–µ–Ω–∞</button>
                    <button type="submit" class="btn btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // –î–∞–Ω–Ω—ã–µ
        let employees = [
            { id: 1, name: '–ê–Ω–Ω–∞ –ü–µ—Ç—Ä–æ–≤–∞', email: 'anna@company.com', position: 'UX/UI –î–∏–∑–∞–π–Ω–µ—Ä', username: '@anna_designer' },
            { id: 2, name: '–ê–ª–µ–∫—Å–µ–π –°–º–∏—Ä–Ω–æ–≤', email: 'alex@company.com', position: 'Frontend Developer', username: '@alex_dev' },
            { id: 3, name: '–ú–∞—Ä–∏—è –ò–≤–∞–Ω–æ–≤–∞', email: 'maria@company.com', position: 'Project Manager', username: '@maria_pm' },
            { id: 4, name: '–î–º–∏—Ç—Ä–∏–π –ö–æ–∑–ª–æ–≤', email: 'dmitry@company.com', position: 'Backend Developer', username: '@dmitry_backend' }
        ];

        let tasks = [];
        let nextEmployeeId = 5;
        let currentFilter = 'all';

        // API —Ñ—É–Ω–∫—Ü–∏–∏
        async function fetchTasks() {
            try {
                const response = await fetch('/api/tasks');
                if (response.ok) {
                    tasks = await response.json();
                } else {
                    console.error('Failed to fetch tasks');
                }
            } catch (error) {
                console.error('Error fetching tasks:', error);
            }
        }

        async function fetchStats() {
            try {
                const response = await fetch('/api/stats');
                if (response.ok) {
                    const stats = await response.json();
                    updateStatsDisplay(stats);
                } else {
                    console.error('Failed to fetch stats');
                }
            } catch (error) {
                console.error('Error fetching stats:', error);
            }
        }

        async function completeTaskAPI(taskId) {
            try {
                const response = await fetch(`/api/tasks/${taskId}/complete`, {
                    method: 'PUT'
                });
                return response.ok;
            } catch (error) {
                console.error('Error completing task:', error);
                return false;
            }
        }

        async function deleteTaskAPI(taskId) {
            try {
                const response = await fetch(`/api/tasks/${taskId}`, {
                    method: 'DELETE'
                });
                return response.ok;
            } catch (error) {
                console.error('Error deleting task:', error);
                return false;
            }
        }

        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±–æ—Ç–æ–º
        async function checkBotStatus() {
            try {
                const response = await fetch('/api/bot/status');
                if (response.ok) {
                    const status = await response.json();
                    updateBotStatusDisplay(status);
                }
            } catch (error) {
                console.error('Error checking bot status:', error);
                updateBotStatusDisplay({ isRunning: false, hasToken: false });
            }
        }

        function updateBotStatusDisplay(status) {
            const statusElement = document.getElementById('botStatus');
            
            if (status.isRunning) {
                statusElement.innerHTML = '<span style="color: #4caf50;">üü¢ –†–∞–±–æ—Ç–∞–µ—Ç</span>';
            } else if (status.hasToken) {
                statusElement.innerHTML = '<span style="color: #ff9800;">üü° –û—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω</span>';
            } else {
                statusElement.innerHTML = '<span style="color: #f44336;">üî¥ –ù–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω</span>';
            }
        }

        async function saveBotToken() {
            const token = document.getElementById('botTokenInput').value.trim();
            
            if (!token) {
                alert('–í–≤–µ–¥–∏—Ç–µ —Ç–æ–∫–µ–Ω –±–æ—Ç–∞');
                return;
            }

            try {
                const response = await fetch('/api/bot/token', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ token })
                });

                const result = await response.json();
                
                if (response.ok) {
                    alert('–ë–æ—Ç —É—Å–ø–µ—à–Ω–æ –∑–∞–ø—É—â–µ–Ω!');
                    document.getElementById('botTokenInput').value = '';
                    checkBotStatus();
                } else {
                    alert('–û—à–∏–±–∫–∞: ' + result.error);
                }
            } catch (error) {
                console.error('Error saving bot token:', error);
                alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ —Ç–æ–∫–µ–Ω–∞');
            }
        }

        async function stopBot() {
            if (!confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –±–æ—Ç–∞?')) {
                return;
            }

            try {
                const response = await fetch('/api/bot/stop', {
                    method: 'POST'
                });

                const result = await response.json();
                
                if (response.ok) {
                    alert('–ë–æ—Ç –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω');
                    checkBotStatus();
                } else {
                    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–µ –±–æ—Ç–∞');
                }
            } catch (error) {
                console.error('Error stopping bot:', error);
                alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–µ –±–æ—Ç–∞');
            }
        }

        async function testBotNotifications() {
            try {
                // –ü–æ–ª—É—á–∞–µ–º chat_id –∏–∑ –ø–æ—Å–ª–µ–¥–Ω–µ–π –∑–∞–¥–∞—á–∏
                const response = await fetch('/api/tasks');
                if (response.ok) {
                    const tasks = await response.json();
                    if (tasks.length === 0) {
                        alert('–ù–µ—Ç –∑–∞–¥–∞—á –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è. –°–æ–∑–¥–∞–π—Ç–µ –∑–∞–¥–∞—á—É —Å–Ω–∞—á–∞–ª–∞.');
                        return;
                    }
                    
                    const chatId = tasks[0].chat_id;
                    console.log(`Testing notifications with chat_id: ${chatId}`);
                    
                    const testResponse = await fetch('/api/bot/test', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ chatId })
                    });

                    const result = await testResponse.json();
                    
                    if (testResponse.ok) {
                        alert('–¢–µ—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ Telegram!');
                    } else {
                        alert(`–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ: ${result.error}`);
                        console.error('Test error details:', result);
                    }
                } else {
                    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –∑–∞–¥–∞—á –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è');
                }
            } catch (error) {
                console.error('Error testing bot:', error);
                alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ –±–æ—Ç–∞');
            }
        }

        // –ù–∞–≤–∏–≥–∞—Ü–∏—è
        function showPage(pageName) {
            // –°–∫—Ä—ã—Ç—å –≤—Å–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
            document.querySelectorAll('.page').forEach(page => page.style.display = 'none');
            
            // –ü–æ–∫–∞–∑–∞—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
            document.getElementById(pageName + '-page').style.display = 'block';
            
            // –û–±–Ω–æ–≤–∏—Ç—å –∞–∫—Ç–∏–≤–Ω—É—é –Ω–∞–≤–∏–≥–∞—Ü–∏—é
            document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
            event.target.classList.add('active');

            // –û–±–Ω–æ–≤–∏—Ç—å –∫–æ–Ω—Ç–µ–Ω—Ç
            if (pageName === 'dashboard') {
                loadDashboard();
            } else if (pageName === 'employees') {
                renderEmployees();
            } else if (pageName === 'rating') {
                loadRating();
            } else if (pageName === 'analytics') {
                loadAnalytics();
            } else if (pageName === 'users') {
                loadUsers();
            } else if (pageName === 'settings') {
                checkBotStatus();
                loadSettings();
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–∞—à–±–æ—Ä–¥–∞
        async function loadDashboard() {
            await fetchTasks();
            updateStats();
            renderTasks();
        }

        // –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞
        function openTaskModal() {
            updateAssigneeSelect();
            document.getElementById('taskModal').classList.add('show');
            // –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ç–µ–∫—É—â—É—é –¥–∞—Ç—É –∏ –≤—Ä–µ–º—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
            const now = new Date();
            now.setMinutes(now.getMinutes() - now.getTimezoneOffset());
            document.getElementById('taskDeadline').value = now.toISOString().slice(0, 16);
        }

        function openEmployeeModal() {
            document.getElementById('employeeModal').classList.add('show');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('show');
            // –û—á–∏—Å—Ç–∏—Ç—å —Ñ–æ—Ä–º—ã
            if (modalId === 'taskModal') {
                document.getElementById('taskForm').reset();
            } else if (modalId === 'employeeModal') {
                document.getElementById('employeeForm').reset();
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–µ–π
        function updateAssigneeSelect() {
            const select = document.getElementById('taskAssignee');
            select.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è</option>';
            
            employees.forEach(employee => {
                const option = document.createElement('option');
                option.value = employee.id;
                option.textContent = `${employee.name} (${employee.position})`;
                select.appendChild(option);
            });
        }

        // –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ –∑–∞–¥–∞—á
        function renderTasks() {
            const container = document.getElementById('taskList');
            const filteredTasks = tasks.filter(task => {
                if (currentFilter === 'all') return true;
                if (currentFilter === 'overdue') {
                    return task.status === 'pending' && task.deadline && new Date(task.deadline) < new Date();
                }
                return task.status === currentFilter;
            });

            if (filteredTasks.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <svg viewBox="0 0 24 24" fill="currentColor">
                            <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/>
                        </svg>
                        <h3>–ó–∞–¥–∞—á –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</h3>
                        <p>–ó–∞–¥–∞—á–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ Telegram –±–æ—Ç–∞ –∫–æ–º–∞–Ω–¥–æ–π /task</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = filteredTasks.map(task => {
                const isOverdue = task.status === 'pending' && task.deadline && new Date(task.deadline) < new Date();
                const statusClass = isOverdue ? 'overdue' : task.status;
                
                let statusText = '–í —Ä–∞–±–æ—Ç–µ';
                if (isOverdue) statusText = '–ü—Ä–æ—Å—Ä–æ—á–µ–Ω–æ';
                else if (task.status === 'completed') statusText = '–í—ã–ø–æ–ª–Ω–µ–Ω–æ';
                else if (task.status === 'review') statusText = '–ù–∞ –ø—Ä–æ–≤–µ—Ä–∫–µ';
                else if (task.status === 'revision') statusText = '–ù–∞ –¥–æ—Ä–∞–±–æ—Ç–∫–µ';
                
                const creatorName = task.first_name + (task.last_name ? ` ${task.last_name}` : '');
                let deadlineText = '–ù–µ —É–∫–∞–∑–∞–Ω';
                if (task.deadline) {
                    try {
                        const deadlineDate = new Date(task.deadline);
                        deadlineText = deadlineDate.toLocaleDateString('ru-RU') + ' ' + deadlineDate.toLocaleTimeString('ru-RU', {hour: '2-digit', minute:'2-digit'});
                    } catch (e) {
                        deadlineText = task.deadline;
                    }
                }

                return `
                    <div class="task-item">
                        <div class="task-info">
                            <div class="task-title">${task.title}</div>
                            <div class="task-meta">
                                <span>üë§ ${task.assignee_username}</span>
                                <span>üìÖ ${deadlineText}</span>
                                <span>üë®‚Äçüíº ${creatorName}</span>
                                ${task.time_spent_minutes ? `<span>‚è±Ô∏è ${task.time_spent_minutes}–º</span>` : ''}
                                ${task.efficiency_score ? `<span>üìä ${Math.round(task.efficiency_score * 100)}%</span>` : ''}
                                ${task.revision_count > 0 ? `<span>üîÑ ${task.revision_count} –¥–æ—Ä–∞–±–æ—Ç–æ–∫</span>` : ''}
                            </div>
                            ${task.description ? `<div style="margin-top: 5px; font-size: 13px; color: #64748b;">${task.description}</div>` : ''}
                            ${task.review_comment ? `<div style="margin-top: 5px; font-size: 13px; color: #d84315; background: #fbe9e7; padding: 8px; border-radius: 4px;"><strong>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π:</strong> ${task.review_comment}</div>` : ''}
                        </div>
                        <div style="display: flex; align-items: center; gap: 15px;">
                            <span class="task-status status-${statusClass}">${statusText}</span>
                            <div class="task-actions">
                                ${task.status === 'review' ? `
                                    <button class="btn btn-success" onclick="approveTaskWeb(${task.id})" style="padding: 6px 12px; font-size: 12px;">
                                        ‚úÖ –ü—Ä–∏–Ω—è—Ç—å
                                    </button>
                                    <button class="btn" style="background: #ff5722; color: white; padding: 6px 12px; font-size: 12px;" onclick="rejectTaskWeb(${task.id})">
                                        üîÑ –û—Ç–∫–ª–æ–Ω–∏—Ç—å
                                    </button>
                                ` : task.status === 'revision' ? `
                                    <button class="btn btn-success" onclick="approveTaskWeb(${task.id})" style="padding: 6px 12px; font-size: 12px;">
                                        ‚úÖ –ü—Ä–∏–Ω—è—Ç—å –∫–∞–∫ –µ—Å—Ç—å
                                    </button>
                                ` : ''}
                                ${(task.status === 'pending' || task.status === 'revision') ? `
                                    <button class="btn" style="background: #2196f3; color: white; padding: 6px 12px; font-size: 12px;" onclick="remindTask(${task.id})">
                                        ‚è∞ –ù–∞–ø–æ–º–Ω–∏—Ç—å
                                    </button>
                                ` : ''}
                                <button class="btn btn-secondary" onclick="editTask(${task.id})" style="padding: 6px 12px; font-size: 12px;">
                                    ‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
                                </button>
                                <button class="btn btn-danger" onclick="deleteTask(${task.id})" style="padding: 6px 12px; font-size: 12px;">
                                    üóëÔ∏è
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤
        function renderEmployees() {
            const container = document.getElementById('employeeList');
            
            if (employees.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <svg viewBox="0 0 24 24" fill="currentColor">
                            <path d="M16 7c0-2.21-1.79-4-4-4S8 4.79 8 7s1.79 4 4 4 4-1.79 4-4zm-4 6c-2.67 0-8 1.34-8 4v3h16v-3c0-2.66-5.33-4-8-4z"/>
                        </svg>
                        <h3>–°–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –Ω–µ—Ç</h3>
                        <p>–î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤–æ–≥–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = employees.map(employee => `
                <div class="employee-card">
                    <div class="employee-info">
                        <div class="employee-avatar">
                            ${employee.name.charAt(0).toUpperCase()}
                        </div>
                        <div class="employee-details">
                            <h4>${employee.name}</h4>
                            <p>${employee.position} ‚Ä¢ ${employee.email}</p>
                            <p style="color: #00796b; font-weight: 500;">${employee.username}</p>
                        </div>
                    </div>
                    <button class="btn btn-danger" onclick="deleteEmployee(${employee.id})" style="padding: 8px 12px; font-size: 12px;">
                        –£–¥–∞–ª–∏—Ç—å
                    </button>
                </div>
            `).join('');
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        function updateStats() {
            fetchStats();
        }

        function updateStatsDisplay(stats) {
            document.getElementById('totalTasks').textContent = stats.total || 0;
            document.getElementById('completedTasks').textContent = stats.completed || 0;
            document.getElementById('pendingTasks').textContent = (stats.pending || 0) - (stats.overdue || 0);
            document.getElementById('overdueTasks').textContent = stats.overdue || 0;
            document.getElementById('reviewTasks').textContent = stats.review || 0;
            document.getElementById('revisionTasks').textContent = stats.revision || 0;
            
            // –ù–æ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏
            const avgTime = stats.avg_completion_time ? Math.round(stats.avg_completion_time) : 0;
            document.getElementById('avgCompletionTime').textContent = avgTime;
            
            const efficiency = stats.avg_efficiency ? Math.round(stats.avg_efficiency * 100) : 0;
            document.getElementById('avgEfficiency').textContent = efficiency + '%';
            
            document.getElementById('totalRevisions').textContent = stats.total_revisions || 0;
        }

        // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∑–∞–¥–∞—á
        function filterTasks(filter) {
            currentFilter = filter;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π —Ç–∞–±
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');
            
            renderTasks();
        }

        // –û–ø–µ—Ä–∞—Ü–∏–∏ —Å –∑–∞–¥–∞—á–∞–º–∏
        async function completeTask(id) {
            const success = await completeTaskAPI(id);
            if (success) {
                await fetchTasks();
                updateStats();
                renderTasks();
            } else {
                alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –∑–∞–¥–∞—á–∏');
            }
        }

        async function deleteTask(id) {
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç—É –∑–∞–¥–∞—á—É?')) {
                const success = await deleteTaskAPI(id);
                if (success) {
                    await fetchTasks();
                    updateStats();
                    renderTasks();
                } else {
                    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –∑–∞–¥–∞—á–∏');
                }
            }
        }

        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∑–∞–¥–∞—á–∞–º–∏ —á–µ—Ä–µ–∑ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
        async function approveTaskWeb(taskId) {
            try {
                const response = await fetch(`/api/tasks/${taskId}/approve`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ reviewerId: 'web-admin' })
                });

                if (response.ok) {
                    await fetchTasks();
                    updateStats();
                    renderTasks();
                    alert('–ó–∞–¥–∞—á–∞ –ø—Ä–∏–Ω—è—Ç–∞! –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å –ø–æ–ª—É—á–∏–ª —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∏ –±–∞–ª–ª—ã –≤ Telegram.');
                } else {
                    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–∏–Ω—è—Ç–∏–∏ –∑–∞–¥–∞—á–∏');
                }
            } catch (error) {
                console.error('Error approving task:', error);
                alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–∏–Ω—è—Ç–∏–∏ –∑–∞–¥–∞—á–∏');
            }
        }

        async function rejectTaskWeb(taskId) {
            const comment = prompt('–í–≤–µ–¥–∏—Ç–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –¥–ª—è –¥–æ—Ä–∞–±–æ—Ç–∫–∏:');
            if (!comment) return;

            console.log(`Rejecting task ${taskId} with comment: "${comment}"`);

            try {
                const response = await fetch(`/api/tasks/${taskId}/revision`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ reviewerId: 'web-admin', comment })
                });

                console.log('Rejection response status:', response.status);
                const result = await response.json();
                console.log('Rejection response:', result);

                if (response.ok) {
                    await fetchTasks();
                    updateStats();
                    renderTasks();
                    alert('–ó–∞–¥–∞—á–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ –Ω–∞ –¥–æ—Ä–∞–±–æ—Ç–∫—É. –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å –ø–æ–ª—É—á–∏–ª —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ Telegram.');
                } else {
                    alert(`–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–∏ –∑–∞–¥–∞—á–∏: ${result.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'}`);
                }
            } catch (error) {
                console.error('Error rejecting task:', error);
                alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–∏ –∑–∞–¥–∞—á–∏');
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è
        async function remindTask(taskId) {
            try {
                const response = await fetch(`/api/tasks/${taskId}/remind`, {
                    method: 'POST'
                });

                if (response.ok) {
                    alert('–ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ Telegram!');
                } else {
                    const error = await response.json();
                    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è: ' + (error.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'));
                }
            } catch (error) {
                console.error('Error sending reminder:', error);
                alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è');
            }
        }

        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ä–µ–π—Ç–∏–Ω–≥–æ–º
        async function loadRating() {
            try {
                const response = await fetch('/api/rating');
                if (response.ok) {
                    const rating = await response.json();
                    renderRating(rating);
                } else {
                    console.error('Failed to load rating');
                }
            } catch (error) {
                console.error('Error loading rating:', error);
            }
        }

        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∞–Ω–∞–ª–∏—Ç–∏–∫–æ–π
        async function loadAnalytics() {
            try {
                const [detailedResponse, performanceResponse] = await Promise.all([
                    fetch('/api/stats/detailed'),
                    fetch('/api/stats/performance')
                ]);

                if (detailedResponse.ok) {
                    const detailedStats = await detailedResponse.json();
                    renderDetailedStats(detailedStats);
                }

                if (performanceResponse.ok) {
                    const performanceMetrics = await performanceResponse.json();
                    renderPerformanceMetrics(performanceMetrics);
                }
            } catch (error) {
                console.error('Error loading analytics:', error);
            }
        }

        function renderDetailedStats(stats) {
            const container = document.getElementById('detailedStatsContainer');
            
            if (stats.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <svg viewBox="0 0 24 24" fill="currentColor">
                            <path d="M16,11V3H8v6H2v12h20V11H16z M10,5h4v14h-4V5z M4,11h4v8H4V11z M20,19h-4v-6h4V19z"/>
                        </svg>
                        <h3>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞</h3>
                        <p>–í—ã–ø–æ–ª–Ω–∏—Ç–µ –∑–∞–¥–∞—á–∏ —á—Ç–æ–±—ã –ø–æ—è–≤–∏–ª–∞—Å—å –∞–Ω–∞–ª–∏—Ç–∏–∫–∞</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = stats.map(stat => {
                const completionRate = stat.total_tasks > 0 ? Math.round((stat.completed_tasks / stat.total_tasks) * 100) : 0;
                const avgTime = stat.avg_time ? Math.round(stat.avg_time) : 0;
                const efficiency = stat.avg_efficiency ? Math.round(stat.avg_efficiency * 100) : 0;
                
                return `
                    <div class="employee-card" style="margin-bottom: 15px;">
                        <div class="employee-info">
                            <div class="employee-avatar">
                                ${stat.assignee_username.replace('@', '').charAt(0).toUpperCase()}
                            </div>
                            <div class="employee-details">
                                <h4>${stat.assignee_username}</h4>
                                <p>${stat.completed_tasks}/${stat.total_tasks} –∑–∞–¥–∞—á –≤—ã–ø–æ–ª–Ω–µ–Ω–æ (${completionRate}%)</p>
                            </div>
                        </div>
                        <div style="display: flex; gap: 20px; align-items: center;">
                            <div style="text-align: center;">
                                <div style="font-size: 1.2rem; font-weight: 600; color: #9c27b0;">${avgTime}–º</div>
                                <div style="font-size: 12px; color: #64748b;">—Å—Ä. –≤—Ä–µ–º—è</div>
                            </div>
                            <div style="text-align: center;">
                                <div style="font-size: 1.2rem; font-weight: 600; color: #607d8b;">${efficiency}%</div>
                                <div style="font-size: 12px; color: #64748b;">—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</div>
                            </div>
                            <div style="text-align: center;">
                                <div style="font-size: 1.2rem; font-weight: 600; color: #795548;">${stat.total_revisions || 0}</div>
                                <div style="font-size: 12px; color: #64748b;">–¥–æ—Ä–∞–±–æ—Ç–∫–∏</div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function renderPerformanceMetrics(metrics) {
            const container = document.getElementById('performanceMetricsContainer');
            
            if (metrics.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <svg viewBox="0 0 24 24" fill="currentColor">
                            <path d="M3 13h8V3H3v10zm0 8h8v-6H3v6zm10 0h8V11h-8v10zm0-18v6h8V3h-8z"/>
                        </svg>
                        <h3>–î–∞–Ω–Ω—ã–µ –∑–∞ –ø–µ—Ä–∏–æ–¥ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã</h3>
                        <p>–°–æ–∑–¥–∞–π—Ç–µ –∑–∞–¥–∞—á–∏ —á—Ç–æ–±—ã –ø–æ—è–≤–∏–ª–∏—Å—å –º–µ—Ç—Ä–∏–∫–∏</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = `
                <div style="margin-bottom: 20px;">
                    <h4 style="margin-bottom: 15px;">–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ –¥–Ω–∏</h4>
                </div>
                ${metrics.slice(0, 10).map(metric => {
                    const date = new Date(metric.date).toLocaleDateString('ru-RU');
                    const avgTime = metric.avg_completion_time ? Math.round(metric.avg_completion_time) : 0;
                    
                    return `
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px 0; border-bottom: 1px solid #f1f5f9;">
                            <div style="font-weight: 500;">${date}</div>
                            <div style="display: flex; gap: 30px;">
                                <span style="color: #00796b;">üìù ${metric.tasks_created} —Å–æ–∑–¥–∞–Ω–æ</span>
                                <span style="color: #4caf50;">‚úÖ ${metric.tasks_completed || 0} –≤—ã–ø–æ–ª–Ω–µ–Ω–æ</span>
                                <span style="color: #9c27b0;">‚è±Ô∏è ${avgTime}–º —Å—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è</span>
                            </div>
                        </div>
                    `;
                }).join('')}
            `;
        }

        function renderRating(rating) {
            const container = document.getElementById('ratingList');
            
            if (rating.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <svg viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                        </svg>
                        <h3>–†–µ–π—Ç–∏–Ω–≥ –ø—É—Å—Ç</h3>
                        <p>–í—ã–ø–æ–ª–Ω–∏—Ç–µ –ø–µ—Ä–≤—ã–µ –∑–∞–¥–∞—á–∏ —á—Ç–æ–±—ã –ø–æ—è–≤–∏–ª–∏—Å—å –±–∞–ª–ª—ã</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = rating.map((user, index) => {
                const position = index + 1;
                const topClass = position <= 3 ? `top-${position}` : '';
                const medal = position === 1 ? 'ü•á' : position === 2 ? 'ü•à' : position === 3 ? 'ü•â' : '';
                
                return `
                    <div class="rating-item ${topClass}">
                        <div class="rating-position">${medal || position}</div>
                        <div class="rating-info">
                            <div class="rating-name">${user.first_name}${user.last_name ? ` ${user.last_name}` : ''}</div>
                            <div class="rating-username">@${user.username || 'unknown'}</div>
                        </div>
                        <div class="rating-stats">
                            <div>
                                <div class="rating-points">üíé ${user.points}</div>
                                <div style="font-size: 12px; color: #64748b;">–±–∞–ª–ª–æ–≤</div>
                            </div>
                            <div>
                                <div class="rating-balance">üí∞ ${user.balance}</div>
                                <div style="font-size: 12px; color: #64748b;">–±–∞–ª–∞–Ω—Å</div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // –û–ø–µ—Ä–∞—Ü–∏–∏ —Å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º–∏
        function deleteEmployee(id) {
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ–≥–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞?')) {
                employees = employees.filter(emp => emp.id !== id);
                renderEmployees();
                updateAssigneeSelect();
            }
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Ñ–æ—Ä–º
        document.getElementById('taskForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const title = document.getElementById('taskTitle').value;
            const assigneeId = parseInt(document.getElementById('taskAssignee').value);
            const description = document.getElementById('taskDescription').value;
            const deadline = document.getElementById('taskDeadline').value;

            if (!title || !assigneeId || !deadline) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è');
                return;
            }

            const newTask = {
                id: nextTaskId++,
                title,
                assigneeId,
                description,
                deadline,
                status: 'pending',
                createdAt: new Date().toISOString(),
                createdBy: '–¢–µ–∫—É—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å'
            };

            tasks.unshift(newTask);
            updateStats();
            renderTasks();
            closeModal('taskModal');
        });

        document.getElementById('employeeForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const name = document.getElementById('employeeName').value;
            const email = document.getElementById('employeeEmail').value;
            const position = document.getElementById('employeePosition').value;
            let username = document.getElementById('employeeUsername').value;

            if (!name || !email) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è');
                return;
            }

            // –î–æ–±–∞–≤–ª—è–µ–º @ –µ—Å–ª–∏ –µ–≥–æ –Ω–µ—Ç
            if (username && !username.startsWith('@')) {
                username = '@' + username;
            }

            const newEmployee = {
                id: nextEmployeeId++,
                name,
                email,
                position: position || '–°–æ—Ç—Ä—É–¥–Ω–∏–∫',
                username: username || `@${email.split('@')[0]}`
            };

            employees.push(newEmployee);
            renderEmployees();
            updateAssigneeSelect();
            closeModal('employeeModal');
        });

        // –§—É–Ω–∫—Ü–∏—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–¥–∞—á–∏
        function editTask(taskId) {
            const task = tasks.find(t => t.id === taskId);
            if (!task) {
                alert('–ó–∞–¥–∞—á–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞');
                return;
            }
            
            document.getElementById('editTaskId').value = task.id;
            document.getElementById('editTaskTitle').value = task.title;
            document.getElementById('editTaskDescription').value = task.description || '';
            
            // –ü—Ä–∞–≤–∏–ª—å–Ω–æ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –¥–∞—Ç—É –∏ –≤—Ä–µ–º—è
            if (task.deadline) {
                // –ï—Å–ª–∏ –¥–µ–¥–ª–∞–π–Ω —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–æ–ª—å–∫–æ –¥–∞—Ç—É, –¥–æ–±–∞–≤–ª—è–µ–º –≤—Ä–µ–º—è
                let dateTimeValue = task.deadline;
                if (task.deadline.length === 10) { // –¢–æ–ª—å–∫–æ –¥–∞—Ç–∞ (YYYY-MM-DD)
                    dateTimeValue = task.deadline + 'T23:59';
                } else if (task.deadline.includes(' ')) {
                    // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º —Ñ–æ—Ä–º–∞—Ç "YYYY-MM-DD HH:MM" –≤ "YYYY-MM-DDTHH:MM"
                    dateTimeValue = task.deadline.replace(' ', 'T');
                }
                document.getElementById('editTaskDeadline').value = dateTimeValue;
            }
            
            document.getElementById('editTaskModal').classList.add('show');
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ñ–æ—Ä–º—ã —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–¥–∞—á–∏
        document.getElementById('editTaskForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const taskId = document.getElementById('editTaskId').value;
            const title = document.getElementById('editTaskTitle').value;
            const description = document.getElementById('editTaskDescription').value;
            const deadline = document.getElementById('editTaskDeadline').value;

            if (!title || !deadline) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è');
                return;
            }

            try {
                const response = await fetch(`/api/tasks/${taskId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ title, description, deadline })
                });

                if (response.ok) {
                    await fetchTasks();
                    updateStats();
                    renderTasks();
                    closeModal('editTaskModal');
                    alert('–ó–∞–¥–∞—á–∞ —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∞');
                } else {
                    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –∑–∞–¥–∞—á–∏');
                }
            } catch (error) {
                console.error('Error updating task:', error);
                alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –∑–∞–¥–∞—á–∏');
            }
        });

        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω –ø–æ –∫–ª–∏–∫—É –Ω–∞ —Ñ–æ–Ω
        document.querySelectorAll('.modal').forEach(modal => {
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    closeModal(modal.id);
                }
            });
        });

        // –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å - –º–æ–±–∏–ª—å–Ω–æ–µ –º–µ–Ω—é
        function toggleMobileMenu() {
            document.getElementById('sidebar').classList.toggle('mobile-open');
        }

        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º
        async function loadUserInfo() {
            try {
                const response = await fetch('/api/user');
                if (response.ok) {
                    const user = await response.json();
                    displayUserInfo(user);
                } else if (response.status === 401) {
                    // –ù–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω, –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ –ª–æ–≥–∏–Ω
                    window.location.href = '/login';
                } else {
                    console.error('Failed to load user info');
                }
            } catch (error) {
                console.error('Error loading user info:', error);
                window.location.href = '/login';
            }
        }

        function displayUserInfo(user) {
            document.getElementById('userName').textContent = user.name || user.email;
            document.getElementById('userRole').textContent = getRoleName(user.role);
            
            const avatar = document.getElementById('userAvatar');
            if (user.avatar) {
                avatar.src = user.avatar;
                avatar.style.display = 'block';
            } else {
                avatar.style.display = 'none';
            }
        }

        function getRoleName(role) {
            switch (role) {
                case 'admin': return '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä';
                case 'manager': return '–ú–µ–Ω–µ–¥–∂–µ—Ä';
                case 'executor': return '–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å';
                default: return '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å';
            }
        }

        function logout() {
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –≤—ã–π—Ç–∏?')) {
                window.location.href = '/logout';
            }
        }

        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
        async function loadUsers() {
            try {
                const response = await fetch('/api/users/roles');
                if (response.ok) {
                    const users = await response.json();
                    renderUsers(users);
                } else {
                    console.error('Failed to load users');
                }
            } catch (error) {
                console.error('Error loading users:', error);
            }
        }

        function renderUsers(users) {
            const container = document.getElementById('usersList');
            
            if (users.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <svg viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 2c2.21 0 4 1.79 4 4 0 2.21-1.59 3.92-3.75 4l.75.75 2.25 2.25c.39.39.39 1.02 0 1.41s-1.02.39-1.41 0L11.59 12.16c-.59.13-1.2.34-1.8.34C7.58 12.5 6 10.92 6 9s1.58-3.5 3.79-3.5zM10 7c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1z"/>
                        </svg>
                        <h3>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –Ω–µ—Ç</h3>
                        <p>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø–æ—è–≤—è—Ç—Å—è –ø–æ—Å–ª–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å –±–æ—Ç–æ–º</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = users.map(user => {
                const roleColor = user.role === 'admin' ? '#f44336' : user.role === 'manager' ? '#ff9800' : '#4caf50';
                const roleName = user.role === 'admin' ? '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä' : user.role === 'manager' ? '–ú–µ–Ω–µ–¥–∂–µ—Ä' : '–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å';
                
                return `
                    <div class="employee-card" style="margin-bottom: 15px;">
                        <div class="employee-info">
                            <div class="employee-avatar">
                                ${(user.first_name || user.username || 'U').charAt(0).toUpperCase()}
                            </div>
                            <div class="employee-details">
                                <h4>${user.first_name || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'}${user.last_name ? ` ${user.last_name}` : ''}</h4>
                                <p>@${user.username || 'unknown'} ‚Ä¢ üíé ${user.points || 0} –±–∞–ª–ª–æ–≤</p>
                                <p style="color: ${roleColor}; font-weight: 600;">${roleName}</p>
                            </div>
                        </div>
                        <div style="display: flex; gap: 10px;">
                            <select onchange="updateUserRole('${user.user_id}', this.value)" class="form-select" style="width: 150px;">
                                <option value="executor" ${user.role === 'executor' ? 'selected' : ''}>–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å</option>
                                <option value="manager" ${user.role === 'manager' ? 'selected' : ''}>–ú–µ–Ω–µ–¥–∂–µ—Ä</option>
                                <option value="admin" ${user.role === 'admin' ? 'selected' : ''}>–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</option>
                            </select>
                        </div>
                    </div>
                `;
            }).join('');
        }

        async function updateUserRole(userId, role) {
            try {
                const response = await fetch(`/api/users/${userId}/role`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ role })
                });

                if (response.ok) {
                    alert('–†–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞!');
                    loadUsers(); // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å–ø–∏—Å–æ–∫
                } else {
                    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Ä–æ–ª–∏');
                }
            } catch (error) {
                console.error('Error updating user role:', error);
                alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Ä–æ–ª–∏');
            }
        }

        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏
        async function loadSettings() {
            try {
                const response = await fetch('/api/settings');
                if (response.ok) {
                    const settings = await response.json();
                    applySettings(settings);
                }
            } catch (error) {
                console.error('Error loading settings:', error);
            }
        }

        function applySettings(settings) {
            const workChatId = settings.find(s => s.key === 'work_chat_id');
            if (workChatId && workChatId.value) {
                document.getElementById('workChatId').value = workChatId.value;
            }
        }

        async function saveWorkChatId() {
            const chatId = document.getElementById('workChatId').value.trim();
            
            if (!chatId) {
                alert('–í–≤–µ–¥–∏—Ç–µ Chat ID');
                return;
            }

            try {
                const response = await fetch('/api/settings/work_chat_id', {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ value: chatId })
                });

                if (response.ok) {
                    alert('Chat ID —Å–æ—Ö—Ä–∞–Ω–µ–Ω!');
                } else {
                    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ Chat ID');
                }
            } catch (error) {
                console.error('Error saving chat ID:', error);
                alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ Chat ID');
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        async function initApp() {
            await loadUserInfo();
            updateAssigneeSelect();
            await loadDashboard();
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±–æ—Ç–æ–º
            document.getElementById('saveBotToken').addEventListener('click', saveBotToken);
            document.getElementById('stopBot').addEventListener('click', stopBot);
            document.getElementById('testBot').addEventListener('click', testBotNotifications);
            document.getElementById('refreshBotStatus').addEventListener('click', checkBotStatus);
            document.getElementById('saveWorkChatId').addEventListener('click', saveWorkChatId);
            
            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
            setInterval(async () => {
                if (document.querySelector('.nav-item.active').textContent.includes('–î–∞—à–±–æ—Ä–¥')) {
                    await fetchTasks();
                    updateStats();
                    renderTasks();
                }
            }, 30000);
        }

        // –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        initApp();
    </script>
</body>
</html>
                